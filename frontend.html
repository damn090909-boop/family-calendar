<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>Family Pixel Calendar</title>
    <base target="_top">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <?!= include('styles'); ?>
    <!-- Google Fonts: Press Start 2P for pixel header -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>

    <div id="app-container">
        <!-- 1. Castle Header Section -->
        <header class="header-section" id="headerSection">
            <div class="family-photo-container" id="familyPhotoContainer" style="display:none;">
                <img src="" alt="Family" class="family-photo" id="familyPhotoImg">
            </div>
            <h1 class="month-title" id="currentDateDisplay">2026<span class="small-label">YEAR</span><br>1<span
                    class="small-label">MONTH</span></h1>
            <!-- Arrow controls and User Status REMOVED -->
        </header>
        
        <script>
            // Set header background image with proper opacity via ::before pseudo-element
            <? if (headerBgUrl) { ?>
            const style = document.createElement('style');
            style.textContent = `.header-section::before { background-image: url('<?= headerBgUrl ?>'); }`;
            document.head.appendChild(style);
            <? } ?>
            
            // Set family photo
            <? if (familyPhotoUrl) { ?>
            const familyImg = document.getElementById('familyPhotoImg');
            const familyContainer = document.getElementById('familyPhotoContainer');
            familyImg.src = '<?= familyPhotoUrl ?>';
            familyContainer.style.display = 'block';
            <? } ?>
        </script>

        <!-- 2. Main Content (Calendar) -->
        <div class="calendar-container">
            <div class="calendar-frame">
                <!-- Week Headers -->
                <div class="week-header">
                    <div class="week-day">SUN</div>
                    <div class="week-day">MON</div>
                    <div class="week-day">TUE</div>
                    <div class="week-day">WED</div>
                    <div class="week-day">THU</div>
                    <div class="week-day">FRI</div>
                    <div class="week-day">SAT</div>
                </div>

                <!-- Days Grid -->
                <div id="calendarGrid" class="calendar-grid">
                    <!-- Days will be generated by JS -->
                </div>
            </div>
        </div>

        <!-- 3. Bottom Navigation Bar REMOVED -->
        <nav class="bottom-nav" style="display:none;">
        </nav>

        <!-- Modals (Overlay) -->
        <!-- Registration Popup -->
        <div id="registrationModal" class="modal-overlay hidden">
            <div class="modal-box pixel-box">
                <div class="modal-header">
                    <h2>[ ÏÇ¨Ïö©ÏûêÎì±Î°ù ]</h2>
                </div>
                <div class="modal-content">
                    <div class="input-group">
                        <label>ÏÇ¨Ïö©ÏûêÏù¥Î¶Ñ :</label>
                        <input type="text" id="regName" class="pixel-input name-input" placeholder="Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                    </div>
                    <div class="input-group">
                        <label>ÏÇ¨ÏßÑÎì±Î°ù :</label>
                        <div class="file-upload-wrapper">
                            <input type="file" id="regPhotoFile" accept="image/*" class="pixel-input-file"
                                style="display:none;" capture="environment">
                            <input type="file" id="regPhotoAlbum" accept="image/*" class="pixel-input-file"
                                style="display:none;">
                            <div class="photo-options">
                                <button type="button" id="cameraBtn" class="photo-btn" title="Ïπ¥Î©îÎùº Ï¥¨ÏòÅ">
                                    üì∑
                                </button>
                                <button type="button" id="albumBtn" class="photo-btn" title="Ïï®Î≤îÏóêÏÑú ÏÑ†ÌÉù">
                                    üìÅ
                                </button>
                            </div>
                            <label id="photoPreview" class="photo-preview-box">
                                ÏÇ¨ÏßÑÏùÑ Îì±Î°ùÌï¥Ï£ºÏÑ∏Ïöî
                            </label>
                        </div>
                        <input type="hidden" id="regPhotoBase64">
                    </div>
                    <button id="saveUserBtn" class="pixel-btn primary full-width" disabled>Ï†ÄÏû•ÌïòÍ∏∞</button>
                </div>
            </div>
        </div>

        <!-- Day View List Popup -->
        <div id="dayModal" class="modal-overlay hidden">
            <div class="modal-box pixel-box">
                <div class="day-modal-header">
                    <span id="dayModalDate" class="day-modal-date">DATE</span>
                    <div style="display:flex; gap:10px;">
                        <button id="headerAddBtn" class="pixel-btn-small" style="font-size:1.2rem;">+</button>
                        <button class="close-btn pixel-btn-small">X</button>
                    </div>
                </div>
                <div class="modal-content">
                    <!-- Events List -->
                    <div class="event-list-container">
                        <ul id="dayEventList" style="list-style:none; padding:0; margin:0;">
                            <!-- Events injected by JS -->
                        </ul>
                    </div>
                    <!-- Empty State Message -->
                    <div id="emptyListMsg" style="display:none; text-align:center; padding:20px; color:#aaa;">
                        NO QUESTS YET
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Event Overlay (Separate Modal) -->
        <div id="eventEditorModal" class="modal-overlay hidden" style="z-index: 150;">
            <div class="modal-box pixel-box">
                <div class="modal-header">
                    <h2 id="editorTitle">ÏùºÏ†ï Îì±Î°ù</h2>
                    <button id="closeEditorBtn" class="pixel-btn-small">X</button>
                </div>
                <div class="modal-content">
                    <div class="add-event-section">
                        <div class="event-form-group">
                            <label class="event-form-label">ÏùºÏ†ï ÎÇ¥Ïö©</label>
                            <input type="text" id="eventTitleInput" class="pixel-input" style="height:40px;" placeholder="ÏùºÏ†ï ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî">
                        </div>

                        <div class="event-form-group">
                            <label class="event-form-label">ÏãúÏûë ÏùºÏãú</label>
                            <div class="date-time-row">
                                <input type="date" id="eventStartDate" class="pixel-input" style="font-size:18px; letter-spacing:-0.5px;">
                                <input type="time" id="eventStartTime" class="pixel-input" style="font-size:18px; letter-spacing:-0.5px;">
                            </div>
                        </div>

                        <div class="event-form-group">
                            <label class="event-form-label">Ï¢ÖÎ£å ÏùºÏãú</label>
                            <div class="date-time-row">
                                <input type="date" id="eventEndDate" class="pixel-input" style="font-size:18px; letter-spacing:-0.5px;">
                                <input type="time" id="eventEndTime" class="pixel-input" style="font-size:18px; letter-spacing:-0.5px;">
                            </div>
                        </div>

                        <div class="event-form-group">
                            <label class="event-form-label">ÎùºÎ≤® ÏÉâÏÉÅ</label>
                            <div class="color-picker-container" id="eventColorPicker">
                                <!-- Colors injected by JS -->
                            </div>
                            <input type="hidden" id="eventColorInput" value="#9b59b6">
                        </div>

                        <div class="event-form-group">
                            <label class="event-form-label"
                                style="display:flex; justify-content:flex-start; align-items:center; gap:5px;">
                                <span>ÏïåÎûå ÏÑ§Ï†ï</span>
                                <input type="checkbox" id="eventAlarmToggle" style="margin:0; margin-left:5px;">
                            </label>
                            <div class="alarm-input-wrapper" id="alarmWrapper">
                                <span>ÏãúÏûë ÏãúÍ∞Ñ</span>
                                <input type="number" id="eventAlarmInput" class="pixel-input alarm-input" value="10">
                                <span>Î∂Ñ Ï†Ñ</span>
                            </div>
                        </div>

                        <input type="hidden" id="editEventId"> <!-- For updates -->

                        <button id="saveEventBtn" class="pixel-btn primary full-width">ÏùºÏ†ï Ï∂îÍ∞Ä</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Delete Modal (Z-Index 200) -->
        <div id="confirmDeleteModal" class="confirm-overlay hidden">
            <div class="confirm-box">
                <p style="margin-bottom:20px; font-size:1.1rem; line-height:1.5;">Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?</p>
                <div style="display:flex; justify-content:center; gap:15px;">
                    <button id="confirmDeleteYes" class="pixel-btn" style="background:var(--btn-orange);">ÏÇ≠Ï†ú</button>
                    <button id="confirmDeleteNo" class="pixel-btn" style="background:#555;">Ï∑®ÏÜå</button>
                </div>
            </div>
        </div>

        <!-- Date Picker Modal -->
        <div id="datePickerModal" class="modal-overlay hidden">
            <div class="modal-box pixel-box">
                <div class="modal-header">
                    <h2>TIME TRAVEL</h2>
                    <button class="close-btn pixel-btn-small">X</button>
                </div>
                <div class="modal-content" style="text-align:center;">
                    <div style="margin-bottom:20px; display:flex; align-items:center; justify-content:center; gap:15px;">
                        <select id="yearSelect" class="pixel-input" style="font-size:18px; text-align:center; flex:1; letter-spacing:-0.5px;">
                            <!-- JS will populate -->
                        </select>
                        <select id="monthSelect" class="pixel-input" style="font-size:18px; text-align:center; flex:1; letter-spacing:-0.5px;">
                            <!-- JS will populate -->
                        </select>
                    </div>
                    <div style="display:flex; justify-content:center; gap:10px;">
                        <button id="resetDateBtn" class="pixel-btn" style="flex:1; background:#555;">Ï¥àÍ∏∞Ìôî</button>
                        <button id="confirmDateBtn" class="pixel-btn primary" style="flex:1;">ÏÑ†ÌÉù</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Hidden data containers -->
    <div id="initialEventsData" style="display:none;"></div>
    <div id="initialUsersData" style="display:none;"></div>

    <script src="scripts.js"></script>
</body>

</html>